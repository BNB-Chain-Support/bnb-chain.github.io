"use strict";(self.webpackChunkbeta_BNB_Docs=self.webpackChunkbeta_BNB_Docs||[]).push([[8374],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},92327:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_label:"Storage MetaData Models",sidebar_position:2,hide_table_of_contents:!1},i="Storage MetaData Models",s={unversionedId:"greenfield/tech-specs/storage-metadata-models",id:"greenfield/tech-specs/storage-metadata-models",title:"Storage MetaData Models",description:"The basic data models for Greenfield storage are:",source:"@site/docs/greenfield/tech-specs/storage-metadata-models.md",sourceDirName:"greenfield/tech-specs",slug:"/greenfield/tech-specs/storage-metadata-models",permalink:"/docs/greenfield/tech-specs/storage-metadata-models",draft:!1,editUrl:"https://github.com/bnb-chain/bnb-chain.github.io/blob/master/docs/greenfield/tech-specs/storage-metadata-models.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_label:"Storage MetaData Models",sidebar_position:2,hide_table_of_contents:!1}},l={},p=[{value:"Bucket",id:"bucket",level:2},{value:"Object",id:"object",level:2},{value:"Group",id:"group",level:2},{value:"Permission",id:"permission",level:2},{value:"Ownership",id:"ownership",level:3},{value:"Permission Definitions",id:"permission-definitions",level:3},{value:"Single User Permission",id:"single-user-permission",level:5},{value:"Group User Permission",id:"group-user-permission",level:4},{value:"Permission Removal",id:"permission-removal",level:3},{value:"Examples",id:"examples",level:3}],c={toc:p},u="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"storage-metadata-models"},"Storage MetaData Models"),(0,r.kt)("p",null,"The basic data models for Greenfield storage are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#bucket"},"Bucket")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#object"},"Object")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#group"},"Group")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#permission"},"Permission"))),(0,r.kt)("p",null,"These metadata are stored as blockchain state into the persistent\nstorage of the Greenfield blockchain."),(0,r.kt)("h2",{id:"bucket"},"Bucket"),(0,r.kt)("p",null,'Bucket is the unit to group storage "',(0,r.kt)("strong",{parentName:"p"},"objects"),'". BucketName has to be\nglobally unique. Every user account can create a bucket. The account\nwill become the "',(0,r.kt)("strong",{parentName:"p"},"owner"),'" of the bucket.'),(0,r.kt)("p",null,"Each bucket should be associated with its own Primary SP, and the payment accounts for Read and Store. The owner's address will be the default payment account."),(0,r.kt)("h2",{id:"object"},"Object"),(0,r.kt)("p",null,"Object is the basic unit to store data on Greenfield. The metadata for\nthe object will be stored on the Greenfield blockchain:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"name and ID"),(0,r.kt)("li",{parentName:"ul"},"owner"),(0,r.kt)("li",{parentName:"ul"},"bucket that hosts it"),(0,r.kt)("li",{parentName:"ul"},"size and timestamps"),(0,r.kt)("li",{parentName:"ul"},"content type"),(0,r.kt)("li",{parentName:"ul"},"checkSums for the storage pieces"),(0,r.kt)("li",{parentName:"ul"},"storage status"),(0,r.kt)("li",{parentName:"ul"},"associated SP information")),(0,r.kt)("p",null,"Object metadata is stored with the bucket name as the prefix of the key.\nIt is possible to iterate through all objects under the same bucket, but\nit may be a heavy-lifting job for a large bucket with lots of objects."),(0,r.kt)("h2",{id:"group"},"Group"),(0,r.kt)("p",null,"A Group is a collection of accounts with the same permissions. The group\nname is not allowed to be duplicated under the same user. However, a\ngroup ",(0,r.kt)("strong",{parentName:"p"},"can not create or own")," any resource. A group ",(0,r.kt)("strong",{parentName:"p"},"can not be a\nmember")," of another group either."),(0,r.kt)("p",null,"A resource can only have a limited number of groups associated with it\nfor permissions. This ensures that the on-chain permission check can be\nfinished within a constant time."),(0,r.kt)("h2",{id:"permission"},"Permission"),(0,r.kt)("p",null,"Bucket, object, group are all resources (payment account is another type\nof resource but is covered in the payment section later). Each resource\nhas a unique ID and the Permission Module uses these IDs to control how\nthe resources can be accessed."),(0,r.kt)("h3",{id:"ownership"},"Ownership"),(0,r.kt)("p",null,"The resources owner refers to the account that creates the resource. By\ndefault, only the resource owner has permission to access its resources."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The resource creator owns the resource."),(0,r.kt)("li",{parentName:"ul"},"Each resource only has one owner and the ownership cannot be transferred once the resource is created."),(0,r.kt)("li",{parentName:"ul"},'There are features that allow an address to "approve" another address to create and upload objects to be owned by the approver\'s address, as long as it is within limits.'),(0,r.kt)("li",{parentName:"ul"},"The owner or payment account of the owner pays for the resource.")),(0,r.kt)("h3",{id:"permission-definitions"},"Permission Definitions"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Ownership Permission:")," By default, the owner has all permissions to the resource.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Public or Private Permission:")," By default, the resource is ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"private")),", only the owner can access the resource. If a resource is ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"public")),", anyone can access it.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Shared Permission:")," These permissions are managed by the permission module. It usually manages who has permission for which resources."))),(0,r.kt)("p",null,"There are two types of permissions: ",(0,r.kt)("strong",{parentName:"p"},"Single User Permission")," and ",(0,r.kt)("strong",{parentName:"p"},"Group User Permission"),", which are stored in different formats in the blockchain state."),(0,r.kt)("h5",{id:"single-user-permission"},"Single User Permission"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Bucket: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x10 | ResouceID(Bucket) | Address(Grantee) \u279d Protobuf(PermissionInfo)")),(0,r.kt)("li",{parentName:"ul"},"Object: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x11 | ResouceID(Object) | Address(Grantee) \u279d Protobuf(PermissionInfo)")),(0,r.kt)("li",{parentName:"ul"},"Group: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x12 | ResouceID(Group) | Address(Grantee) \u279d Protobuf(PermissionInfo)"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type permissionInfo struct {\n  ActionList     []Action  // [GetObject,PutObject...]\n  resourceList   []string  // optional\uff0cFor prefix resource.\n  Allow          Effect    // optional, For some scenarios where some permissions need to be prohibited\n}\n")),(0,r.kt)("h4",{id:"group-user-permission"},"Group User Permission"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Bucket: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x20 | ResouceID(Bucket)  \u279d Protobuf(GroupPermissionInfo)")),(0,r.kt)("li",{parentName:"ul"},"Object: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x21 | ResouceID(Object)  \u279d Protobuf(GroupPermissionInfo)")),(0,r.kt)("li",{parentName:"ul"},"Group: ",(0,r.kt)("inlineCode",{parentName:"li"},"0x22 | ResouceID(Group)  \u279d Protobuf(GroupPermissionInfo)"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type GroupPermissionInfo map[uint32]permissionInfo // groupID \u279d permissionInfo mapping, mapsize limit to 20?\n")),(0,r.kt)("h3",{id:"permission-removal"},"Permission Removal"),(0,r.kt)("p",null,"Users can actively remove one or more permissions. However, when a\nresource is deleted, its associated permissions should also be deleted,\nperhaps not by the user taking the initiative to delete it, but by other\nclean-up mechanisms. Because if too many accounts have permission to the\ndeleting object, it takes too much time to process within one\ntransaction handling."),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Typical permissions for the resources are listed below."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Permission Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Bucket"),(0,r.kt)("th",{parentName:"tr",align:null},"Object"),(0,r.kt)("th",{parentName:"tr",align:null},"Group"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Write"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow PutObject"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow AddMember")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Read"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow ListObject"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow GetObject"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow ListMember As a member of this group")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Full Control"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow Put/ListObject, Allow DeleteBucket"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow GetObject, Allow DeleteObject"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow DeleteMember, Allow ListMember")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Execute"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Allow Execute"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c")))),(0,r.kt)("p",null,"Let's say Greenfield has two accounts, ",(0,r.kt)("em",{parentName:"p"},"Bob(0x1110)")," and ",(0,r.kt)("em",{parentName:"p"},"Alice(0x1111)"),". A basic example scenario would be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Bob uploaded a picture named avatar.jpg into a bucket named "profile";')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Bob grants the GetObject action permission for the object avatar.jpg to Alice, it will store a key ",(0,r.kt)("inlineCode",{parentName:"p"},"0x11 | ResourceID(profile_avatar.jpg) | Address(Alice)")," into a permission state tree.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"when Alice wants to read the avatar.jpg, the SP should check the Greenfield blockchain that whether the key ",(0,r.kt)("inlineCode",{parentName:"p"},"Prefix(ObjectPermission) | ResourceID(profile_avatar.jpg) | Address(Alice)")," existed in the permission state tree, and whether the action list contains GetObject."))),(0,r.kt)("p",null,"Let's move on to more complex scenarios:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Bob created a bucket named "profile"'),(0,r.kt)("li",{parentName:"ul"},'Bob grants the PutObject action permission for the bucket "profile"\nto Alice, the key ',(0,r.kt)("inlineCode",{parentName:"li"},"0x10 | ResourceID(profile) | Address(Alice)"),"\nwill be put into the permission state tree."),(0,r.kt)("li",{parentName:"ul"},"When Alice wants to upload an object named ",(0,r.kt)("inlineCode",{parentName:"li"},"avatar.jpg")," into the\nbucket profile, it creates a PutObject transaction and will be\nexecuted on the chain."),(0,r.kt)("li",{parentName:"ul"},"The Greenfield blockchain needs to confirm that Alice has permission\nto operate, so it checks whether the key ",(0,r.kt)("inlineCode",{parentName:"li"},"0x10 |\nResourceID(profile) | Address(Alice)")," existed in the permission\nstate tree and got the permission information if it existed."),(0,r.kt)("li",{parentName:"ul"},"If the permission info shows that Alice has the ",(0,r.kt)("inlineCode",{parentName:"li"},"PutObject")," action\npermission of the bucket profile, then she can do ",(0,r.kt)("inlineCode",{parentName:"li"},"PutObject")," operation.")),(0,r.kt)("p",null,"Another more complex scenario that contains groups:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Bob creates a group named "',(0,r.kt)("strong",{parentName:"li"},"Games"),'", and creates a bucket named "',(0,r.kt)("strong",{parentName:"li"},"profile"),'".'),(0,r.kt)("li",{parentName:"ul"},"Bob adds Alice to the Games group, the key ",(0,r.kt)("inlineCode",{parentName:"li"},"0x12 | ResourceID(Games)\n| Address(Alice)")," will be put into the permission state tree"),(0,r.kt)("li",{parentName:"ul"},"Bob put a picture ",(0,r.kt)("inlineCode",{parentName:"li"},"avatar.jpg")," to the bucket ",(0,r.kt)("inlineCode",{parentName:"li"},"profile "),"and grants the\n",(0,r.kt)("inlineCode",{parentName:"li"},"CopyObject")," action permission to the group Games"),(0,r.kt)("li",{parentName:"ul"},"When Alice wants to copy the object ",(0,r.kt)("inlineCode",{parentName:"li"},"avatar.jpg"),", First, Greenfield\nblockchain checks whether she has permission via the key ",(0,r.kt)("inlineCode",{parentName:"li"},"0x11 |\nResourceID(avatar.jpg) | Address(Alice)"),"; if it is a miss,\nGreenfield will iterate all groups that the object ",(0,r.kt)("inlineCode",{parentName:"li"},"avatar.jpg"),"\nassociates and check whether Alice is a member of one of these\ngroups by checking, e.g. if the key ",(0,r.kt)("inlineCode",{parentName:"li"},"0x21 | ResourceID(group, e.g.\nGames)")," existed, then iterate the ",(0,r.kt)("inlineCode",{parentName:"li"},"permissionInfo")," map, and determine if Alice is in a group which has the permission to do ",(0,r.kt)("inlineCode",{parentName:"li"},"CopyObject")," operation via the key ",(0,r.kt)("inlineCode",{parentName:"li"},"0x12| ResourceID(Games) | Address(Alice)"))))}m.isMDXComponent=!0}}]);